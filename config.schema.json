{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://peter120525-cmd.github.io/Lawmadi-Public/config.schema.json",
  "title": "Lawmadi OS Configuration Schema (Public / Sanitized)",
  "description": "JSON Schema for Lawmadi OS (LDOS) runtime configuration. Public/sanitized version — proprietary scoring formulas, production endpoints, API keys, and internal policy weights are excluded. All runtime parameters are centrally controlled by a single config.json file (Configuration SSOT). Copyright © 2026 Jainam Choe (최재남). All rights reserved.",
  "type": "object",
  "required": [
    "$meta",
    "constitution",
    "fsm",
    "evidence",
    "temporal",
    "decision_graph",
    "decision_token",
    "leader_swarm",
    "cache",
    "security",
    "gateway",
    "observability",
    "output",
    "llm_integration",
    "safety"
  ],
  "additionalProperties": false,
  "properties": {
    "$meta": {
      "type": "object",
      "description": "Configuration metadata and versioning.",
      "required": [
        "config_version",
        "schema_version",
        "constitution_version",
        "environment",
        "last_updated"
      ],
      "additionalProperties": false,
      "properties": {
        "config_version": {
          "type": "string",
          "description": "Semantic version of this configuration file.",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "examples": [
            "2.1.0"
          ]
        },
        "schema_version": {
          "type": "string",
          "description": "Version of the config schema this file conforms to.",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "examples": [
            "2.1.0"
          ]
        },
        "constitution_version": {
          "type": "string",
          "description": "Version of the Operating Constitution enforced at runtime. MUST appear in every decision output.",
          "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
          "examples": [
            "2.1"
          ]
        },
        "environment": {
          "type": "string",
          "description": "Deployment environment.",
          "enum": [
            "development",
            "staging",
            "production",
            "public-sandbox"
          ]
        },
        "last_updated": {
          "type": "string",
          "description": "ISO-8601 timestamp of last configuration change.",
          "format": "date-time"
        },
        "updated_by": {
          "type": "string",
          "description": "Identifier of the person or system that last updated this configuration.",
          "examples": [
            "public-release"
          ]
        },
        "changelog_url": {
          "type": "string",
          "description": "URL to the configuration changelog.",
          "format": "uri"
        }
      }
    },
    "constitution": {
      "type": "object",
      "description": "Operating Constitution enforcement settings. These five principles are NON-NEGOTIABLE.",
      "required": [
        "ssot",
        "zero_inference",
        "fail_closed",
        "live_evidence",
        "deterministic_boundary",
        "dsl"
      ],
      "additionalProperties": false,
      "properties": {
        "ssot": {
          "type": "object",
          "required": [
            "enabled",
            "allow_permanent_storage",
            "allow_dataset_replication"
          ],
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true,
              "description": "SSOT enforcement enabled. MUST be true."
            },
            "allow_permanent_storage": {
              "type": "boolean",
              "const": false,
              "description": "Allow permanent storage of statute/precedent/regulation data. MUST be false."
            },
            "allow_dataset_replication": {
              "type": "boolean",
              "const": false,
              "description": "Allow replication of official legal datasets. MUST be false."
            }
          }
        },
        "zero_inference": {
          "type": "object",
          "required": [
            "enabled"
          ],
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true,
              "description": "Zero Inference enforcement enabled. MUST be true."
            },
            "allow_unsourced_legal_claims": {
              "type": "boolean",
              "const": false,
              "description": "Allow unsourced legal claims in output. MUST be false."
            }
          }
        },
        "fail_closed": {
          "type": "object",
          "required": [
            "enabled",
            "allow_unverified_output"
          ],
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true,
              "description": "Fail-Closed enforcement enabled. MUST be true."
            },
            "allow_unverified_output": {
              "type": "boolean",
              "const": false,
              "description": "Allow unverified legal conclusions. MUST be false."
            },
            "reference_only_fallback": {
              "type": "boolean",
              "description": "Allow Reference-Only mode degraded fallback.",
              "default": false
            }
          }
        },
        "live_evidence": {
          "type": "object",
          "required": [
            "enabled"
          ],
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true,
              "description": "Live Evidence enforcement enabled. MUST be true."
            }
          }
        },
        "deterministic_boundary": {
          "type": "object",
          "required": [
            "enabled",
            "llm_may_control_fsm",
            "llm_may_override_tools",
            "llm_may_access_secrets"
          ],
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true
            },
            "llm_may_control_fsm": {
              "type": "boolean",
              "const": false
            },
            "llm_may_override_tools": {
              "type": "boolean",
              "const": false
            },
            "llm_may_access_secrets": {
              "type": "boolean",
              "const": false
            }
          }
        },
        "dsl": {
          "type": "object",
          "required": [
            "enabled",
            "rules"
          ],
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true
            },
            "rules": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^[A-Z][A-Za-z_]+$"
              },
              "minItems": 1,
              "uniqueItems": true,
              "description": "Active Constitution DSL rule identifiers only (sanitized)."
            },
            "enforcement_mode": {
              "type": "string",
              "enum": [
                "reject",
                "warn_and_reject",
                "log_only"
              ],
              "default": "reject"
            }
          }
        }
      }
    },
    "fsm": {
      "type": "object",
      "description": "Deterministic Finite State Machine runtime settings.",
      "required": [
        "states",
        "fail_states",
        "mandatory_gate"
      ],
      "additionalProperties": false,
      "properties": {
        "states": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Ordered sequence of FSM states (Happy Path)."
        },
        "fail_states": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "States that trigger Fail-Closed path."
        },
        "mandatory_gate": {
          "type": "string",
          "const": "EVIDENCE_VALIDATED",
          "description": "Absolute gate — no output without passing."
        },
        "halt_state": {
          "type": "string",
          "const": "HALT"
        },
        "max_state_transition_time_ms": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 120000,
          "default": 30000
        },
        "total_session_timeout_ms": {
          "type": "integer",
          "minimum": 5000,
          "maximum": 600000,
          "default": 120000
        }
      }
    },
    "evidence": {
      "type": "object",
      "description": "Evidence Verification Engine configuration.",
      "required": [
        "sources",
        "pipeline",
        "integrity",
        "trust_score"
      ],
      "additionalProperties": false,
      "properties": {
        "sources": {
          "type": "object",
          "required": [
            "default_jurisdiction"
          ],
          "additionalProperties": false,
          "properties": {
            "default_jurisdiction": {
              "type": "string",
              "description": "Default jurisdiction code (ISO 3166-1 alpha-2).",
              "default": "KR",
              "examples": [
                "KR",
                "US",
                "GB",
                "JP",
                "EU"
              ]
            },
            "jurisdictions": {
              "type": "object",
              "description": "Per-jurisdiction SSOT source configuration. Values contain sanitized source designation.",
              "additionalProperties": {
                "type": "object",
                "required": [
                  "name",
                  "source_type"
                ],
                "additionalProperties": false,
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "source_type": {
                    "type": "string",
                    "enum": [
                      "REST_API",
                      "SOAP_API",
                      "GRAPHQL",
                      "BULK_FEED"
                    ]
                  },
                  "base_url_ref": {
                    "type": "string",
                    "description": "Secure config reference for base URL (not the URL).",
                    "examples": [
                      "SECRET:DRF_BASE_URL"
                    ]
                  },
                  "api_key_ref": {
                    "type": "string",
                    "description": "Secure config reference for API key (not the key).",
                    "examples": [
                      "SECRET:DRF_API_KEY"
                    ]
                  },
                  "timeout_ms": {
                    "type": "integer",
                    "minimum": 1000,
                    "maximum": 60000,
                    "default": 10000
                  },
                  "retry_count": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 5,
                    "default": 2
                  },
                  "retry_backoff_ms": {
                    "type": "integer",
                    "minimum": 100,
                    "maximum": 10000,
                    "default": 1000
                  }
                }
              }
            }
          }
        },
        "pipeline": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "stages": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "AUTHORITATIVE_API_QUERY",
                "EVIDENCE_NORMALIZATION",
                "TEMPORAL_VALIDATION",
                "EVIDENCE_HASHING"
              ]
            },
            "hash_algorithm": {
              "type": "string",
              "enum": [
                "SHA-256"
              ],
              "default": "SHA-256"
            },
            "canonicalization": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "sort_keys": {
                  "type": "boolean",
                  "const": true
                },
                "separators": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "default": [
                    ",",
                    ":"
                  ]
                },
                "ensure_ascii": {
                  "type": "boolean",
                  "default": false
                }
              }
            }
          }
        },
        "integrity": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "reject_non_official_source": {
              "type": "boolean",
              "const": true
            },
            "reject_missing_evidence": {
              "type": "boolean",
              "const": true
            },
            "reject_temporal_failure": {
              "type": "boolean",
              "const": true
            },
            "reject_invalid_status": {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "statuses": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "default": [
                    "REPEALED",
                    "UNCONSTITUTIONAL",
                    "INVALIDATED",
                    "OVERRULED"
                  ]
                }
              }
            }
          }
        },
        "trust_score": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "components": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "default": [
                "source_authority_weight",
                "citation_stability_score",
                "temporal_consistency_score"
              ]
            },
            "minimum_threshold": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "default": 0.0,
              "$comment": "PROPRIETARY: Actual threshold value is confidential."
            },
            "provenance_tracking": {
              "type": "boolean",
              "default": true
            }
          }
        }
      }
    },
    "temporal": {
      "type": "object",
      "description": "Temporal Law Validity Engine configuration.",
      "required": [
        "enabled"
      ],
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "const": true
        },
        "checks": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "effective_date_verification": {
              "type": "boolean",
              "default": true
            },
            "precedent_change_detection": {
              "type": "boolean",
              "default": true
            },
            "unconstitutional_clause_detection": {
              "type": "boolean",
              "default": true
            },
            "as_of_validation": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "unknown_temporal_status_action": {
          "type": "string",
          "enum": [
            "fail_closed",
            "reference_only"
          ],
          "default": "fail_closed"
        }
      }
    },
    "decision_graph": {
      "type": "object",
      "description": "Decision Graph Formal Semantics configuration.",
      "required": [
        "node_types",
        "edge_types",
        "validity_condition_enabled"
      ],
      "additionalProperties": false,
      "properties": {
        "node_types": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [
            "FACT_NODE",
            "ISSUE_NODE",
            "LAW_NODE",
            "PRECEDENT_NODE",
            "DECISION_NODE"
          ]
        },
        "edge_types": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": [
            "SUPPORTS",
            "CONTRADICTS",
            "DEPENDS_ON",
            "RESOLVES",
            "REFERENCES",
            "APPLIES",
            "OVERRULES",
            "TEMPORAL_DEPENDS"
          ]
        },
        "validity_condition_enabled": {
          "type": "boolean",
          "const": true
        },
        "max_nodes": {
          "type": "integer",
          "minimum": 10,
          "maximum": 10000,
          "default": 500
        },
        "max_depth": {
          "type": "integer",
          "minimum": 3,
          "maximum": 100,
          "default": 20
        }
      }
    },
    "decision_token": {
      "type": "object",
      "description": "Decision Token Standard configuration.",
      "required": [
        "enabled",
        "signature"
      ],
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "const": true
        },
        "fields": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "signature": {
          "type": "object",
          "required": [
            "algorithm",
            "key_source"
          ],
          "additionalProperties": false,
          "properties": {
            "algorithm": {
              "type": "string",
              "enum": [
                "Ed25519"
              ],
              "default": "Ed25519"
            },
            "key_source": {
              "type": "string",
              "enum": [
                "KMS",
                "HSM",
                "VAULT",
                "PLACEHOLDER"
              ],
              "default": "PLACEHOLDER"
            },
            "key_ref": {
              "type": "string",
              "description": "Secure config reference for signing key (not the key).",
              "examples": [
                "SECRET:ED25519_SIGNING_KEY"
              ]
            },
            "placeholder_value": {
              "type": "string",
              "default": "PLACEHOLDER_SIGNATURE_PUBLIC_BUILD"
            }
          }
        },
        "hash_algorithm": {
          "type": "string",
          "enum": [
            "SHA-256"
          ],
          "default": "SHA-256"
        }
      }
    },
    "leader_swarm": {
      "type": "object",
      "description": "Leader Swarm Routing Engine configuration (sanitized).",
      "required": [
        "enabled",
        "consensus"
      ],
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "max_concurrent_leaders": {
          "type": "integer",
          "minimum": 1,
          "maximum": 20,
          "default": 3
        },
        "routing_score_components": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "consensus": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "voting_method": {
              "type": "string",
              "enum": [
                "weighted_confidence",
                "majority",
                "unanimous"
              ],
              "default": "weighted_confidence"
            },
            "graph_merge_enabled": {
              "type": "boolean",
              "default": true
            },
            "fallback_escalation_enabled": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "leader_timeout_ms": {
          "type": "integer",
          "minimum": 1000,
          "maximum": 60000,
          "default": 15000
        }
      }
    },
    "cache": {
      "type": "object",
      "description": "Ephemeral cache configuration (acceleration only).",
      "required": [
        "enabled",
        "backend",
        "ttl_seconds"
      ],
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true
        },
        "backend": {
          "type": "string",
          "enum": [
            "redis",
            "memory",
            "none"
          ],
          "default": "redis"
        },
        "ttl_seconds": {
          "type": "integer",
          "minimum": 60,
          "maximum": 1800,
          "default": 600
        },
        "redis_url_ref": {
          "type": "string",
          "description": "Secure config reference for Redis URL.",
          "examples": [
            "SECRET:REDIS_URL"
          ]
        },
        "key_prefix": {
          "type": "string",
          "default": "lawmadi:evidence:"
        },
        "revalidate_on_as_of_mismatch": {
          "type": "boolean",
          "const": true
        }
      }
    },
    "security": {
      "type": "object",
      "description": "Security architecture configuration (sanitized).",
      "required": [
        "prompt_injection_defense",
        "tool_injection_defense",
        "secret_management"
      ],
      "additionalProperties": false,
      "properties": {
        "prompt_injection_defense": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true
            },
            "strip_ignore_patterns": {
              "type": "boolean",
              "default": true
            },
            "treat_user_input_as_untrusted": {
              "type": "boolean",
              "const": true
            }
          }
        },
        "tool_injection_defense": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true
            },
            "tool_allow_list": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "allow_arbitrary_url_fetch": {
              "type": "boolean",
              "const": false
            }
          }
        },
        "secret_management": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "secrets_in_prompts": {
              "type": "boolean",
              "const": false
            },
            "secret_backend": {
              "type": "string",
              "enum": [
                "KMS",
                "VAULT",
                "SECRET_MANAGER",
                "ENV_VARS_DEV_ONLY"
              ],
              "default": "KMS"
            },
            "log_secret_access_attempts": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "output_masking": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "mask_pii": {
              "type": "boolean",
              "default": true
            },
            "mask_secrets": {
              "type": "boolean",
              "const": true
            },
            "mask_raw_evidence_payload": {
              "type": "boolean",
              "default": true
            }
          }
        }
      }
    },
    "gateway": {
      "type": "object",
      "description": "API Gateway configuration.",
      "additionalProperties": false,
      "properties": {
        "input_validation": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "json_schema_validation": {
              "type": "boolean",
              "default": true
            },
            "max_input_size_bytes": {
              "type": "integer",
              "minimum": 1024,
              "maximum": 10485760,
              "default": 1048576
            }
          }
        },
        "rate_limiting": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "requests_per_minute": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10000,
              "default": 60
            },
            "burst_limit": {
              "type": "integer",
              "minimum": 1,
              "maximum": 1000,
              "default": 10
            }
          }
        },
        "authentication": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "required": {
              "type": "boolean",
              "default": true
            },
            "method": {
              "type": "string",
              "enum": [
                "IAM",
                "API_KEY",
                "OAUTH2",
                "JWT"
              ],
              "default": "IAM"
            }
          }
        },
        "audit_logging": {
          "type": "boolean",
          "const": true
        }
      }
    },
    "observability": {
      "type": "object",
      "description": "Observability and audit configuration.",
      "required": [
        "audit_log",
        "metrics"
      ],
      "additionalProperties": false,
      "properties": {
        "audit_log": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "const": true
            },
            "append_only": {
              "type": "boolean",
              "const": true
            },
            "log_request_id": {
              "type": "boolean",
              "default": true
            },
            "log_decision_id": {
              "type": "boolean",
              "default": true
            },
            "log_input_hash": {
              "type": "boolean",
              "default": true
            },
            "log_fsm_transitions": {
              "type": "boolean",
              "default": true
            },
            "log_tool_calls": {
              "type": "boolean",
              "default": true
            },
            "log_fail_closed_events": {
              "type": "boolean",
              "default": true
            },
            "log_evidence_replay": {
              "type": "boolean",
              "default": true
            },
            "pii_masking": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "metrics": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "evidence_fetch_success_rate": {
              "type": "boolean",
              "default": true
            },
            "fail_closed_rate_by_code": {
              "type": "boolean",
              "default": true
            },
            "latency_per_fsm_state": {
              "type": "boolean",
              "default": true
            },
            "cache_hit_rate": {
              "type": "boolean",
              "default": true
            },
            "leader_routing_accuracy": {
              "type": "boolean",
              "default": true
            }
          }
        },
        "decision_trace": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "graph_debug_snapshot": {
              "type": "boolean",
              "default": true
            }
          }
        }
      }
    },
    "output": {
      "type": "object",
      "description": "Output schema and formatting configuration.",
      "required": [
        "format",
        "error_codes"
      ],
      "additionalProperties": false,
      "properties": {
        "format": {
          "type": "string",
          "enum": [
            "JSON"
          ],
          "default": "JSON"
        },
        "error_codes": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "LC-001": {
              "type": "string",
              "const": "Evidence source unreachable"
            },
            "LC-002": {
              "type": "string",
              "const": "Evidence mismatch / non-authoritative / integrity failure"
            },
            "LC-003": {
              "type": "string",
              "const": "Constitution violation / invalid schema"
            },
            "LC-004": {
              "type": "string",
              "const": "Temporal invalidity (not effective / expired)"
            },
            "LC-005": {
              "type": "string",
              "const": "Policy restriction (disallowed category)"
            },
            "LC-006": {
              "type": "string",
              "const": "Rate limited / throttled"
            }
          }
        },
        "disclaimer": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "ko": {
              "type": "string"
            },
            "en": {
              "type": "string"
            }
          }
        },
        "streaming": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "allow_status_streaming": {
              "type": "boolean",
              "default": true
            },
            "allow_conclusion_streaming": {
              "type": "boolean",
              "const": false
            },
            "atomic_final_output": {
              "type": "boolean",
              "const": true
            }
          }
        }
      }
    },
    "llm_integration": {
      "type": "object",
      "description": "LLM integration and portability configuration.",
      "required": [
        "role",
        "contracts"
      ],
      "additionalProperties": false,
      "properties": {
        "role": {
          "type": "string",
          "const": "rendering_engine"
        },
        "contracts": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "adapter": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "system_prompt_format": {
              "type": "string",
              "enum": [
                "text",
                "xml",
                "json",
                "markdown"
              ],
              "default": "text"
            },
            "function_calling_schema": {
              "type": "string",
              "enum": [
                "openai_tools",
                "anthropic_tools",
                "google_tools",
                "custom",
                "none"
              ],
              "default": "custom"
            },
            "max_output_tokens": {
              "type": "integer",
              "minimum": 256,
              "maximum": 200000,
              "default": 8192
            },
            "validate_output_json": {
              "type": "boolean",
              "const": true
            }
          }
        },
        "no_function_calling_fallback": {
          "type": "boolean",
          "default": true
        }
      }
    },
    "safety": {
      "type": "object",
      "description": "Safety and compliance policy.",
      "additionalProperties": false,
      "properties": {
        "mode": {
          "type": "string",
          "const": "informational_decision_support"
        },
        "encourage_professional_consultation": {
          "type": "boolean",
          "const": true
        },
        "refuse_harmful_requests": {
          "type": "boolean",
          "const": true
        },
        "emergency_redirect": {
          "type": "boolean",
          "const": true
        }
      }
    }
  }
}
